---
title: "Laboratorio 1 - Análisis exploratorio, PCA y Apriori"
author: "Alexa Bravo, Josué Sagastume"
date: "25/7/2021"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, echo=FALSE}
library(cluster) #Para calcular la silueta
library(e1071)#para cmeans
library(mclust) #mixtures of gaussians
library(fpc) #para hacer el plotcluster
library(NbClust) #Para determinar el n?mero de clusters ?ptimo
library(factoextra) #Para hacer gr?ficos bonitos de clustering
library(rpart)
library(caret)
library(tree)
library(rpart.plot)
library(ggplot2)
library(randomForest)
library(tidyverse)

library(rela)
library(psych)
library(FactoMineR)
library(corrplot)
```

### 1. Datos
```{r , echo=TRUE}
train <- read.csv("./data/train.csv")
test <- read.csv("./data/test.csv")
```

### 1. Análisis exploratorio

```{r}
summary(train)
```

### 2 Tipo de variable
0. ID
1. MSSubClsas = categórica
2. MSZoning = categórica
3. LotFrontage = cuantitativa discreta
4. LotArea = cuantitativa discreta
5. Street = categórica
6. Alley = categórica
7. LotShape = categórica
8. LandContour = categórica
9. Building = categórica
10.Utilities = categórica
11.LotConfig = categórica
12.LandSlope = categórica
13.Neighborhood = categórica
14.Condition1 = categórica
15.Condition2 = categórica
16.BldgType = categórica
17.HouseStyle = categórica
18.OverallQual = categórica
19.OverallCond = categórica
20.YearBuilt = cuantitativa discreta
21.YearRemodAdd = cuantitativa discreta
22.RoofStyle = categórica
23.RoofMatl = categórica
24.Exterior1st = categórica
25.Exterior2nd = categórica
26.MasVnrType = categórica
27.MasVnrArea = cuantitativa discreta
28.ExterQual = categórica
29.ExterCond = categórica
30.Foundation = categórica
31.BsmtQual = categórica
32.BsmtCond = categórica
33.BsmtExposure = categórica
34.BsmtFinType1 = categórica
35.BsmtFinSF1 = cuantitativa continua
36.BsmtFinType2 = categórica
37.BsmtFinSF2 = cuantitativa continua
38.BsmtUnfSF = cuantitativa continua
39.TotalBsmtSF = cuantitativa continua
40.Heating = categórica
41.HeatingQC = categórica
42.CentralAir = categórica
43.Electrical = categórica
44.1stFlrSF = cuantitativa continua
45.2ndFlrSF = cuantitativa continua
46.LowQualFinSF = cuantitativa continua
47.GrLivArea = cuantitativa continua
48.BsmtFullBath = cuantitativa discreta
49.BsmtHalfBath = cuantitativa discreta
50.FullBath = cuantitativa discreta
51.HalfBath = cuantitativa discreta
52.Bedroom = cuantitativa discreta
53.Kitchen = cuantitativa discreta
54.KitchenQual = categórica
55.TotRmsAbvGrd = cuantitativa discreta
56.Functional = categórica
57.Fireplaces = cuantitativa discreta
58.FireplaceQu = categórica
59.GarageType = categórica
60.GarageYrBlt = cuantitativa discreta
61.GarageFinish = categórica
62.GarageCars = cuantitativa discreta
63.GarageArea = cuantitativa discreta
64.GarageQual = categórica
65.GarageCond = categórica
66.PavedDrive = categórica
67.WoodDeckSF = cuantitativa discreta
68.OpenPorchSF = cuantitativa discreta
69.EnclosedPorch = cuantitativa discreta
70.3SsnPorch = cuantitativa discreta
71.ScreenPorch = cuantitativa discreta
72.PoolArea = cuantitativa discreta
73.PoolQC = categórica
74.Fence = categórica
75.MiscFeature = categórica
76.MiscVal = cuantitativa discreta
77.MoSold = categórica
78.YrSold = cuantitativa discreta
79.SaleType = categórica
80.SaleCondition = categórica


CUANTITATIVAS
3. LotFrontage = cuantitativa discreta
4. LotArea = cuantitativa discreta
20.YearBuilt = cuantitativa discreta
21.YearRemodAdd = cuantitativa discreta
27.MasVnrArea = cuantitativa discreta
35.BsmtFinSF1 = cuantitativa continua
37.BsmtFinSF2 = cuantitativa continua
38.BsmtUnfSF = cuantitativa continua
39.TotalBsmtSF = cuantitativa continua
44.1stFlrSF = cuantitativa continua
45.2ndFlrSF = cuantitativa continua
46.LowQualFinSF = cuantitativa continua
47.GrLivArea = cuantitativa continua
48.BsmtFullBath = cuantitativa discreta
49.BsmtHalfBath = cuantitativa discreta
50.FullBath = cuantitativa discreta
51.HalfBath = cuantitativa discreta
52.Bedroom = cuantitativa discreta
53.Kitchen = cuantitativa discreta
55.TotRmsAbvGrd = cuantitativa discreta
57.Fireplaces = cuantitativa discreta
60.GarageYrBlt = cuantitativa discreta
62.GarageCars = cuantitativa discreta
63.GarageArea = cuantitativa discreta
67.WoodDeckSF = cuantitativa discreta
68.OpenPorchSF = cuantitativa discreta
69.EnclosedPorch = cuantitativa discreta
70.3SsnPorch = cuantitativa discreta
71.ScreenPorch = cuantitativa discreta
72.PoolArea = cuantitativa discreta
76.MiscVal = cuantitativa discreta
78.YrSold = cuantitativa discreta


#### 3. Gráficos exploratorios

```{r echo=FALSE}
qqnorm(train$LotFrontage, col= "gray50", main = "Distribucion normal LotFrontage")
qqline(train$LotFrontage)
```
Los datos se aproximan bastante a una distribución normal, sin embargo, tanto al inicio como al final se puede ver cómo estos datos se desvían de la tendencia que debería de seguir.

```{r echo=FALSE}
qqnorm(train$LotArea, col= "gray50", main = "Distribucion normal LotArea")
qqline(train$LotArea)
```
Los datos se aproximan bastante a una distribución normal, pero se puede notar que al final de la gráfica, los datos se desvían, lo que indica que hay un sesgo.

```{r}
qqnorm(train$YearBuilt, col= "gray50", main = "Distribucion normal YearBuilt")
qqline(train$YearBuilt)
```
Los datos se aproximan bastante a una distribución normal, pero se puede notar que al final de la gráfica, los datos se desvían, lo que indica que hay un sesgo.

```{r echo=FALSE}
qqnorm(train$YearRemodAdd, col= "gray50", main = "Distribucion normal YearRemodAdd")
qqline(train$YearRemodAdd)
```
Los datos se aproximan bastante a una distribución normal, sin embargo, tanto al inicio como al final se puede ver cómo estos datos se desvían de la tendencia que debería de seguir.

```{r echo=FALSE}
qqnorm(train$MasVnrArea, col= "gray50", main = "Distribucion normal MasVnrArea")
qqline(train$MasVnrArea)
```
Como se puede observar en la gráfica, los datos no tienen una tendencia normal, pues estos no siguen la línea indicada.

```{r echo=FALSE}
qqnorm(train$BsmtFinSF1, col= "gray50", main = "Distribucion normal BsmtFinSF1")
qqline(train$BsmtFinSF1)
```
Los datos se aproximan bastante a una distribución normal, pero se puede notar que al inicio de la gráfica, los datos se desvían, lo que indica que hay un sesgo.

```{r echo=FALSE}
qqnorm(train$BsmtFinSF2, col= "gray50", main = "Distribucion normal BsmtFinSF2")
qqline(train$BsmtFinSF2)
```
Los datos se aproximan bastante a una distribución normal, pero se puede notar que al final de la gráfica, los datos se desvían, lo que indica que hay un sesgo.

```{r echo=FALSE}
qqnorm(train$BsmtUnfSF, col= "gray50", main = "Distribucion normal BsmtUnfSF")
qqline(train$BsmtUnfSF)
```
Los datos se aproximan bastante a una distribución normal, sin embargo, tanto al inicio como al final se puede ver cómo estos datos se desvían de la tendencia que debería de seguir.

```{r echo=FALSE}
qqnorm(train$Fireplaces, col= "gray50", main = "Distribucion normal Fireplaces")
qqline(train$Fireplaces)
```
Como se puede observar en la gráfica, los datos no tienen una tendencia normal, aunque estos siguen la línea indicada, pero debido a la cantidad de valores que toman estos datos no se logra apreciar.

```{r echo=FALSE}
qqnorm(train$GarageYrBlt, col= "gray50", main = "Distribucion normal GarageYrBlt")
qqline(train$GarageYrBlt)
```
Los datos se aproximan bastante a una distribución normal, pero se puede notar que al final de la gráfica, los datos se desvían, lo que indica que hay un sesgo.

```{r echo=FALSE}
qqnorm(train$GarageCars, col= "gray50", main = "Distribucion normal GarageCars")
qqline(train$GarageCars)
```
Como se puede observar en la gráfica, los datos no tienen una tendencia normal, aunque estos siguen la línea indicada, pero debido a la cantidad de valores que toman estos datos no se logra apreciar.

```{r echo=FALSE}
qqnorm(train$GarageArea, col= "gray50", main = "Distribucion normal GarageArea")
qqline(train$GarageArea)
```
Los datos se aproximan bastante a una distribución normal, sin embargo, tanto al inicio como al final se puede ver cómo estos datos se desvían de la tendencia que debería de seguir.

```{r echo=FALSE}
qqnorm(train$WoodDeckSF, col= "gray50", main = "Distribucion normal WoodDeckSF")
qqline(train$WoodDeckSF)
```
Como se puede observar en la gráfica, los datos no tienen una tendencia normal, pues estos no siguen la línea indicada.

```{r echo=FALSE}
qqnorm(train$OpenPorchSF, col= "gray50", main = "Distribucion normal OpenPorchSF")
qqline(train$OpenPorchSF)
```
Como se puede observar en la gráfica, los datos no tienen una tendencia normal, pues estos no siguen la línea indicada.

```{r echo=FALSE}
qqnorm(train$EnclosedPorch, col= "gray50", main = "Distribucion normal EnclosedPorch")
qqline(train$EnclosedPorch)
```
Los datos se aproximan bastante a una distribución normal, pero se puede notar que al final de la gráfica, los datos se desvían, lo que indica que hay un sesgo.

```{r echo=FALSE}
qqnorm(train$X3SsnPorch, col= "gray50", main = "Distribucion normal 3SsnPorch")
qqline(train$X3SsnPorch)
```
Los datos se aproximan bastante a una distribución normal, pero se puede notar que al final de la gráfica, los datos se desvían, lo que indica que hay un sesgo.

```{r echo=FALSE}
qqnorm(train$ScreenPorch, col= "gray50", main = "Distribucion normal ScreenPorch")
qqline(train$ScreenPorch)
```
Los datos se aproximan bastante a una distribución normal, pero se puede notar que al final de la gráfica, los datos se desvían, lo que indica que hay un sesgo debido a que la mayoría de estos datos cuenta con una cantidad de 0, los datos que sí tienen valor provocan el sesgo.

```{r echo=FALSE}
qqnorm(train$PoolArea, col= "gray50", main = "Distribucion normal PoolArea")
qqline(train$PoolArea)
```
Como se puede observar, ninguna de las casas cuenta con un área para piscina, por lo que, aunque los datos si sigan la línea, estos no se encuentran distribuidos normalmente.

```{r echo=FALSE}
qqnorm(train$MiscVal, col= "gray50", main = "Distribucion normal MiscVal")
qqline(train$MiscVal)
```
Al igual que el caso anterior, la mayoría de los datos no cuentan con un valor para esta variable, por lo que se sesga la distribución normal.

```{r echo=FALSE}
qqnorm(train$YrSold, col= "gray50", main = "Distribucion normal YrSold")
qqline(train$YrSold)
```
Como se puede observar en la gráfica, los datos no tienen una tendencia normal, aunque estos siguen la línea indicada, pero debido a la cantidad de valores que toman estos datos no se logra apreciar.

```{r, echo=FALSE}
qqnorm(train$TotalBsmtSF, col= "gray50", main = "Distribucion Normal TotalBsmtSF")
qqline(train$TotalBsmtSF)
```
Los datos se aproximan bastante a una distribución normal, sin embargo, tanto al inicio como al final se puede ver cómo estos datos se desvían de la tendencia que debería de seguir.

```{r, echo=FALSE}
qqnorm(train$X1stFlrSF, col= "gray50", main = "Distribucion Normal 1stFlrSF")
qqline(train$X1stFlrSF)
```
Los datos se aproximan bastante a una distribución normal, sin embargo, tanto al inicio como al final se puede ver cómo estos datos se desvían de la tendencia que debería de seguir.

```{r, echo=FALSE}
qqnorm(train$X2ndFlrSF, col= "gray50", main = "Distribucion Normal 2ndFlrSF")
qqline(train$X2ndFlrSF)
```
Como se puede observar en la gráfica, los datos no tienen una tendencia normal, pues estos no siguen la línea indicada.

```{r, echo=FALSE}
qqnorm(train$LowQualFinSF, col= "gray50", main = "Distribucion Normal LowQualFinSF")
qqline(train$LowQualFinSF)
```
Los datos se aproximan bastante a una distribución normal, pero se puede notar que al final de la gráfica, los datos se desvían, lo que indica que hay un sesgo debido a que la mayoría de estos datos cuenta con una cantidad de 0, los datos que sí tienen valor provocan el sesgo.

```{r, echo=FALSE}
qqnorm(train$GrLivArea, col= "gray50", main = "Distribucion Normal GrLivArea")
qqline(train$GrLivArea)
```
Los datos se aproximan bastante a una distribución normal, sin embargo, tanto al inicio como al final se puede ver cómo estos datos se desvían de la tendencia que debería de seguir.

```{r, echo=FALSE}
qqnorm(train$BsmtFullBath, col= "gray50", main = "Distribucion Normal BsmtFullBath")
qqline(train$BsmtFullBath)
```
Como se puede observar en la gráfica, los datos no tienen una tendencia normal, aunque estos siguen la línea indicada, pero debido a la cantidad de valores que toman estos datos no se logra apreciar.

```{r, echo=FALSE}
qqnorm(train$BsmtHalfBath, col= "gray50", main = "Distribucion Normal BsmtHalfBath")
qqline(train$BsmtHalfBath)
```
Se puede ver que los datos no siguen una distribución normal debido a que los datos de esta variable solo toman dos valores.

```{r, echo=FALSE}
qqnorm(train$FullBath, col= "gray50", main = "Distribucion Normal FullBath")
qqline(train$FullBath)
```
Como se puede observar en la gráfica, los datos no tienen una tendencia normal, aunque estos siguen la línea indicada, pero debido a la cantidad de valores que toman estos datos no se logra apreciar.

```{r, echo=FALSE}
qqnorm(train$HalfBath, col= "gray50", main = "Distribucion Normal HalfBath")
qqline(train$HalfBath)
```
Como se puede observar en la gráfica, los datos no tienen una tendencia normal, aunque estos siguen la línea indicada, pero debido a la cantidad de valores que toman estos datos no se logra apreciar.

```{r, echo=FALSE}
qqnorm(train$Bedroom, col= "gray50", main = "Distribucion Normal Bedroom")
qqline(train$Bedroom)
```
Como se puede observar en la gráfica, los datos no tienen una tendencia normal, aunque estos siguen la línea indicada, pero debido a la cantidad de valores que toman estos datos no se logra apreciar.

```{r, echo=FALSE}
qqnorm(train$KitchenAbvGr, col= "gray50", main = "Distribucion Normal KitchenAbvGr")
qqline(train$KitchenAbvGr)
```
Como se puede observar en la gráfica, los datos no tienen una tendencia normal, aunque estos siguen la línea indicada, pero debido a la cantidad de valores que toman estos datos no se logra apreciar.

```{r, echo=FALSE}
qqnorm(train$TotRmsAbvGrd, col= "gray50", main = "Distribucion Normal TotRmsAbvGrd")
qqline(train$TotRmsAbvGrd)
```
Como se puede observar en la gráfica, los datos no tienen una tendencia normal, aunque estos siguen la línea indicada, pero debido a la cantidad de valores que toman estos datos no se logra apreciar.


#### 4. Aislar variables numéricas y categóricas

casas <- casas[,c(4,12,17,34,38,46,62,67,81)]
```{r echo=FALSE}

train_cuanti <- train[,c(4,5,20,21,27,35,37,38,39,44,45,46,47,48,49,50,51,52,53,55,57,60,62,63,67,68,69,70,71,72,76,78)]

train_cuali <- train[,c(1,2,3,6,7,8,9,10,11,12,13,14,15,16,17,18,19,22,23,24,25,26,28,29,30,31,32,33,34,36,40,41,42,43,54,56,58,59,61,64,65,66,73,74,75,77,79,80)]
```

```{r echo=FALSE}
plot(x = train_cuali$MSSubClass, y= train_cuali$OverallQual, xlab= "Tamaño del lote", ylab= "Precio de venta", main = "Tamaño vs precios")
abline(lm(train_cuali$OverallQual ~ train_cuali$MSSubClass), col = "blue")
```



```{r, echo=FALSE}
plot(x = train$LotArea, y= train$SalePrice, xlab= "Tamaño del lote", ylab= "Precio de venta", main = "Tamaño vs precios")
abline(lm(train$SalePrice ~ train$LotArea), col = "blue")
```

Podemos ver que el precio de la mayoría de las casas se concentra por debajo de los 50,000. Y también podemos ver que no existe una relación entre el precio de la casa y el tamaño del lote, pues los precios varían bastante entre los mismos metros cuadrados del lote.




```{r, echo=FALSE}
library(ggplot2)
df <- as.data.frame(train$HouseStyle)
ggplot(data=df, aes(x=train$HouseStyle)) + 
  geom_bar(stat="count", 
           width=0.5, 
           color="black",
           fill = "green") +
  labs(x="Estilos", y="Cantidad", title = "Estilos de casa") 
```

Las casas que predominan el mercado son las de un nivel.

```{r, echo=FALSE}
library(ggplot2)
df <- as.data.frame(train$YearBuilt)
ggplot(data=df, aes(x=train$YearBuilt)) + 
  geom_bar(stat="count", 
           width=0.5, 
           color="black",
           fill = "green") +
  labs(x="Año de construcción", y="Cantidad", title = "Año de construcción de la casa") 
```

La década en la que más casas se han construidos han sido de 1900 a los 2000.

```{r, echo=FALSE}
library(ggplot2)
df <- as.data.frame(train$BldgType)
ggplot(data=df, aes(x=train$BldgType)) + 
  geom_bar(stat="count", 
           width=0.5, 
           color="black",
           fill = "green") +
  labs(x="Tipo de vivienda", y="Cantidad", title = "Tipos de vivienda") 
```

Los tipos de casas más populares, son aquellos que fueron diseñados para una sola familia.

```{r, echo=FALSE}
library(ggplot2)
df <- as.data.frame(train$OverallQual)
ggplot(data=df, aes(x=train$OverallQual)) + 
  geom_bar(stat="count", 
           width=0.5, 
           color="black",
           fill = "green") +
  labs(x="Acabado de la casa", y="Cantidad", title = "Material general y acabado de la casa") 

df2 <- as.data.frame(train$OverallCond)
ggplot(data=df2, aes(x=train$OverallCond)) + 
  geom_bar(stat="count", 
           width=0.5, 
           color="black",
           fill = "green") +
  labs(x="Estado de la casa", y="Cantidad", title = "Estado general de la casa") 
```

Las condiciones generales de las casas se encuentra en un rango de 5 a 10.

```{r, echo=FALSE}
library(ggplot2)
df <- as.data.frame(train$Condition1)
ggplot(data=df, aes(x=train$Condition1)) + 
  geom_bar(stat="count", 
           width=0.5, 
           color="black",
           fill = "green") +
  labs(x="Proximidad a condiciones", y="Cantidad", title = "Proximidad de la casa a varias condiciones")
```

La proximidad más popular o que más se da es la normal.


#### PCA
```{r, echo=FALSE}
#datos<-read.csv("./data/Ejemplo.csv",stringsAsFactors = F)

#rcor <- cor(train_cuanti)

#rcor<-cor(datos[,2:8],use = "pairwise.complete.obs")
#det(rcor)#Si el determinante de la matriz de correlaciÃ³n es cercano a 0 significa que hay multicolinealidad

```

#### REGLAS DE ASOCIACIÓN

```{r, echo=FALSE}
install.packages("arules")
library(arules)
# El mínimo nivel de soporte y confianza aceptados
reglas<-apriori(train_cuanti, parameter = list(support = 0.2,
                                        confidence = 0.70,
                                        target = "rules"))

```

